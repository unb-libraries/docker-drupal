sudo: required
services:
  - docker

git:
  depth: 1

env:
  global:
    - DEPLOYMENT_FINISHED_MARKER=99_report_as_complete
    - DOCKER_IMAGE_NAME=unblibraries/drupal
    - DOCKER_IMAGE_TAG=alpine-nginx-php7-8.x-composer
    - DOCKER_UPSTREAM_IMAGE=unblibraries/nginx-php:alpine-php7
    - SERVICE_DEPLOY_PORT=80
    - SERVICE_NAME=docker.drupal.base
    - SERVICE_TEST_UP_PATH=/user

before_install:
  - curl -sSL https://raw.githubusercontent.com/unb-libraries/CargoDock/drupal-8.x-1.x/travis/deploy.sh | sh
  - CargoDock/travis/installDockerCompose.sh

script:
  - CargoDock/travis/buildInstanceForTesting.sh
  - CargoDock/travis/waitForDeploy.sh
  - CargoDock/travis/checkStartupForErrors.sh
  - docker exec -i -t ${SERVICE_NAME} /scripts/runTests.sh

after_success:
  - travis/upstream/triggerDockerHubBuild.sh

notifications:
  slack:
    secure: cQVNyyCZn5x2HHVuNdjbFYuxZ1Pxy4Wf7ZbYeNFnoAKTn7wVGb88Bwu+/T5s+rxLCGteCjx76kQN7UkyGDaQpp1MdZ33knxfAJldeSESDjba/zdYSJGlYKpxtSogUaL5WmobJXqNRaKxpdUgUNMC8rfitcA9t6Q713r3xHivvkZAXap/HjTCzvA6IrW6fRi8nqs0h8V4FdmvvqHCj81yHRSCIdxkJKGXiK1xBP1uZTGtQ5MuWtBXs023UzDHX3SRoj8mRIVq6+qaydUdSkZG7hpK7KOmP7R50WR2/Y6zwNg7e5R5JDzHGB8eQM0o4r4VyAkp7O0YlW6HqZXUk5wlAZo6m6yzOktjMKKH3QB1Cr6lokOxlSvLs1/P8dtEurO8kTfRK+1BxunK/0plTNRvAV9+RsGnWzWPR4mx3iehIOPdRn0y7vzagAEeMbGjItvXnSG9qy+VT1MiuxgLOI4UL74i6n4kwnGGawEEaKtZQApaRsGYDVW2MKplakaaus5AIEGB6yR+gxOq+czaDyQ5Ct+wOjOG0k7ocRNmjq9QD9wrqBd14B+Pm9vT1RRiPHgUOuTGX5cQkNLkuP8fr1PT+NS0ruUVK1DldN5qMFZuA6RuOYfFnSgIqOyT5wkVxW+jWxEi84h3Pnn13jwW/mGRDsqrah9D0oM2g+HptQoUsH8=
